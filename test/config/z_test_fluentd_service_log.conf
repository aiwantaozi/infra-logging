# service log
<source>
  @type tail
  path /var/log/volumes/*/*/*/apache2/* # path is /var/log/volumes/<namespace>/<stack>/<service>/<type>/*.log
  pos_file /fluentd/etc/apache2.log.pos
  tag servicelog.*
  format apache2
</source>

<source>
  @type tail
  path /var/log/volumes/*/*/*/nginx/* # path is /var/log/volumes/<namespace>/<stack>/<service>/<type>/*.log
  pos_file /fluentd/etc/nginx.log.pos
  tag servicelog.*
  format nginx
</source>

<source>
  @type tail
  path /var/log/volumes/*/*/*/syslog/* # path is /var/log/volumes/<namespace>/<stack>/<service>/<type>/*.log
  pos_file /fluentd/etc/syslog.log.pos
  tag servicelog.*
  format syslog
</source>

<filter servicelog.**>
  @type record_transformer
  <record>
    tag ${tag}
    namespace ${tag_parts[4]}
    stack_name ${tag_parts[5]}
    service_name ${tag_parts[6]}
    log_format ${tag_parts[7]}
  </record>
</filter>

<match servicelog.var.log.volumes.ns-1.**>
   @type elasticsearch
   include_tag_key true
   host aliyun_ip
   port 9200
   scheme "http"
  #  user "elastic"
  #  password "changeme"
   reload_connections "true"
   logstash_prefix "test-service"
   logstash_format true
   buffer_chunk_limit 2M
   buffer_queue_limit 32
   flush_interval 5s
   max_retry_wait 30
   disable_retry_limit
   num_threads 8
</match>
# fluentd monitor config
<source>
   @type  monitor_agent
   bind  0.0.0.0
   port  24220
</source>
# output the fluentd log to container
# <match fluent.**>
#   @type stdout
# </match>