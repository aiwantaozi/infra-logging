{{range $i, $listener := .sources -}}
<source>
  type tail
  path {{$listener.Path}}
  pos_file {{$listener.PosFile}}
  time_format %Y-%m-%dT%H:%M:%S.%NZ
  tag {{$listener.Tag}}
  format json
  read_from_head true
</source>
{{end -}}

{{range $i, $backend := .backends -}}
<match {{$backend.Source}}>
   type {{$backend.Type}}
   log_level info
   include_tag_key true
   host {{$backend.Host}}
   port {{$backend.Port}}
   scheme "#{{{$backend.Scheme}} || 'http'}"
   user {{$backend.User}}
   password {{$backend.Password}}
   reload_connections true
   logstash_prefix "#{{{$backend.LogstashPrefix}} || 'logstash'}"
   logstash_format true
   buffer_chunk_limit 2M
   buffer_queue_limit 32
   flush_interval 5s
   max_retry_wait 30
   disable_retry_limit
   num_threads 8
</match>
{{end -}}
